<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todorima – Optimal Reminder — 設定</title>
    <style>
      :root {
        --bg: #F7F8FA;
        --surface: #FFFFFF;
        --text: #172B4D;
        --muted: #6B778C;
        --muted-strong: #475569;
        --border: #DFE1E6;
        --primary: #2684FF;
        --primary-hover: #1D6FE5;
        --radius: 10px;
        --shadow: 0 1px 2px rgba(9,30,66,.1), 0 0 1px rgba(9,30,66,.15);
      }
      body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; background: var(--bg); color: var(--text); }
      header { position: sticky; top: 0; background: linear-gradient(180deg, #FFFFFF 0%, #FAFBFC 100%); border-bottom: 1px solid var(--border); padding: 14px 16px; z-index: 1; }
      header h2 { margin: 0; font-weight: 700; color: var(--text); }
      main { max-width: 760px; margin: 14px auto; padding: 0 14px; }
      .card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); padding: 14px; margin-bottom: 14px; }
      .card h3 { margin: 0 0 10px; font-size: 16px; }
      label { display: block; margin: 12px 0 6px; font-weight: 600; }
      input[type="number"], select, input[type="text"] { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: var(--radius); box-shadow: inset 0 1px 0 rgba(9,30,66,.04); box-sizing: border-box; }
      input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(38,132,255,0.2); }
      .row { display: flex; gap: 12px; align-items: center; }
      .row > * { flex: 1; }
      .small { color: var(--muted); font-size: 12px; }
      .ok { color: #1F845A; font-weight: 600; }
      .btn { padding: 10px 14px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); cursor: pointer; box-shadow: var(--shadow); }
      .btn--primary { background: var(--primary); border-color: var(--primary); color: #fff; }
      .btn--primary:hover { background: var(--primary-hover); }
      .toast { position: fixed; top: 14px; right: 16px; background: #1F845A; color: #fff; padding: 10px 12px; border-radius: 8px; box-shadow: var(--shadow); z-index: 10; font-weight: 600; }
      body[data-theme="dark"] .toast { background: #2ABB7F; color: #0B1220; }
      .switch { display: inline-flex; align-items: center; gap: 8px; }
      .switch input { appearance: none; width: 36px; height: 22px; border-radius: 999px; background: #C1C7D0; position: relative; outline: none; transition: background .2s ease; }
      .switch input::after { content: ""; position: absolute; top: 3px; left: 3px; width: 16px; height: 16px; background: #fff; border-radius: 50%; box-shadow: 0 1px 2px rgba(0,0,0,.2); transition: transform .2s ease; }
      .switch input:checked { background: var(--primary); }
      .switch input:checked::after { transform: translateX(14px); }
      /* ダークモード（ブルーブラック系） */
      @media (prefers-color-scheme: dark) {
        body:not([data-theme="light"]) {
          --bg: #0B1220;
          --surface: #0F172A;
          --text: #E5F0FF;
          --muted: #B6C8E5;
          --muted-strong: #D2DEF6;
          --border: #1F2A44;
          --primary: #5B9EFF;
          --primary-hover: #4A8BFF;
        }
        body:not([data-theme="light"]) header { background: linear-gradient(180deg, #0F172A 0%, #0B1220 100%); border-bottom-color: #1F2A44; }
        body:not([data-theme="light"]) header h2 { color: var(--text); }
      }
      /* 手動ダーク適用（最優先） */
      body[data-theme="dark"] {
        --bg: #0B1220;
        --surface: #0F172A;
        --text: #E5F0FF;
        --muted: #B6C8E5;
        --muted-strong: #D2DEF6;
        --border: #1F2A44;
        --primary: #5B9EFF;
        --primary-hover: #4A8BFF;
      }
      body[data-theme="dark"] header { background: linear-gradient(180deg, #0F172A 0%, #0B1220 100%); border-bottom-color: #1F2A44; }
      body[data-theme="dark"] header h2 { color: var(--text); }
      body[data-theme="dark"] input[type="number"], body[data-theme="dark"] select, body[data-theme="dark"] input[type="text"] { background: #121B30; color: var(--text); border-color: #1F2A44; }
      body[data-theme="dark"] .btn { background: #121B30; }
      body[data-theme="dark"] .btn:hover { background: #15203A; }
      input::placeholder { color: var(--muted); }
      body[data-theme="dark"] input::placeholder { color: var(--muted); }
    </style>
  </head>
  <body>
    <header>
      <h2>Todorima – Optimal Reminder — 設定</h2>
      <div class="small">通知やスヌーズ、復帰後の再通知などの動作をカスタマイズできます。</div>
    </header>
    <main>
      <form id="optForm">
        <div id="toast" class="toast" aria-live="polite" style="display:none"></div>
        <div class="card">
          <h3>通知</h3>
          <label>通知を自動で閉じない</label>
          <div class="switch"><input id="requireInteraction" type="checkbox" /><span class="small">オンにすると、通知を手動で閉じるまで表示を維持します（OSにより無視される場合あり）。</span></div>
          <label style="margin-top:12px;">スヌーズ機能を有効にする</label>
          <div class="switch"><input id="enableSnooze" type="checkbox" checked /><span class="small">オフにすると通知や一覧からスヌーズ操作が非表示になります。</span></div>
        </div>

        <div class="card">
          <h3>スヌーズ</h3>
          <label>既定スヌーズ（分）</label>
          <input id="defaultSnoozeMin" type="number" min="1" value="10" />
        </div>

        <div class="card">
          <h3>予定の表示</h3>
          <label>テーマ</label>
          <select id="themeMode">
            <option value="system">システムに合わせる</option>
            <option value="light">ライト</option>
            <option value="dark">ダーク</option>
          </select>

          <label style="margin-top:8px;">タグ機能を有効にする</label>
          <div class="switch"><input id="showTags" type="checkbox" checked /><span class="small">オフにすると、一覧のタグ表示と入力欄、タグ検索を非表示にします。</span></div>

          <label style="margin-top:8px;">完了セクションを折りたたむ（既定）</label>
          <div class="switch"><input id="completedCollapsed" type="checkbox" checked /><span class="small">オンにすると、一覧の完了セクションが折りたたまれた状態で表示されます。</span></div>

          <label>週の開始曜日</label>
          <select id="weekStartsOn">
            <option value="0">日曜</option>
            <option value="1">月曜</option>
          </select>
        </div>

        <div class="card">
          <h3>スリープ復帰時の再通知</h3>
          <label>復帰後に通知し直す対象期間（時間）</label>
          <input id="catchupHours" type="number" min="1" value="12" />
          <div class="small">PCのスリープ等で不在の間に、この時間内に期限を過ぎたタスクを復帰後に通知します。</div>

          <label>復帰後に個別通知する最大件数</label>
          <input id="maxIndividualCatchup" type="number" min="0" value="5" />
        </div>

        <div class="card">
          <h3>データ管理</h3>
          <label>完了タスクの自動削除（保持日数）</label>
          <input id="completedRetentionDays" type="number" min="0" value="30" />
          <div class="small">0にすると自動削除を無効化します。既定は30日。</div>
        </div>

        <div class="card" style="display:flex; justify-content: space-between; align-items: center; gap: 12px;">
          <div class="small">設定は `chrome.storage.sync` に保存され、サインインしているブラウザ間で同期されます。</div>
          <button class="btn btn--primary" type="submit">保存</button>
        </div>
        <div class="small" id="status"></div>
      </form>
    </main>

    <script type="module" src="./options.js"></script>
  </body>
  </html>
