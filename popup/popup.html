<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todorima – Optimal Reminder</title>
    <style>
      :root {
        --bg: #F7F8FA;
        --surface: #FFFFFF;
        --elevated: #FFFFFF;
        --text: #172B4D;
        --muted: #6B778C;
        --muted-strong: #475569;
        --border: #DFE1E6;
        --primary: #2684FF;
        --primary-hover: #1D6FE5;
        --danger: #DE350B;
        --danger-hover: #BF2600;
        --success: #36B37E;
        --warning: #FFAB00;
        --radius: 10px;
        --spacing: 10px;
        --shadow: 0 1px 2px rgba(9,30,66,.1), 0 0 1px rgba(9,30,66,.15);
      }
      body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; width: 440px; background: var(--bg); color: var(--text); }
      header { display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, #FFFFFF 0%, #FAFBFC 100%); position: sticky; top: 0; z-index: 2; }
      header .title { font-weight: 700; letter-spacing: .2px; color: var(--text); }
      header a { color: var(--primary); text-decoration: none; font-weight: 500; }
      header a:hover { text-decoration: underline; }
      .nav { display: flex; gap: 6px; padding: 8px; background: transparent; position: sticky; top: 52px; z-index: 1; }
      .tab { padding: 8px 12px; border-radius: 999px; border: 1px solid var(--border); background: var(--surface); cursor: pointer; font-size: 12px; box-shadow: var(--shadow); }
      .tab.active { border-color: var(--primary); color: var(--primary); box-shadow: 0 0 0 2px rgba(38,132,255,0.15), var(--shadow); }
      .container { padding: 10px; }
      form input, form select, form textarea { width: 100%; box-sizing: border-box; margin: 6px 0 12px; padding: 10px 12px; border: 1px solid var(--border); border-radius: var(--radius); background: var(--surface); color: var(--text); box-shadow: inset 0 1px 0 rgba(9,30,66,.04); }
      form input:focus, form select:focus, form textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(38,132,255,0.2); }
      /* ツールバーの入力/セレクトもフォームと同じ見た目に */
      .toolbar input, .toolbar select { width: 100%; box-sizing: border-box; padding: 10px 12px; border: 1px solid var(--border); border-radius: var(--radius); background: var(--surface); color: var(--text); box-shadow: inset 0 1px 0 rgba(9,30,66,.04); }
      .toolbar input:focus, .toolbar select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(38,132,255,0.2); }
      textarea { resize: vertical; }
      .row { display: flex; gap: 10px; }
      .row > * { flex: 1; }
      .small { font-size: 12px; color: var(--muted); }
      input::placeholder, textarea::placeholder { color: var(--muted); opacity: .9; }
      select { color: var(--text); }
      .tasks { margin-top: 8px; max-height: 480px; overflow-y: auto; padding-bottom: 8px; }
      .task { border: 1px solid var(--border); border-radius: var(--radius); padding: 12px; margin-bottom: 10px; background: var(--elevated); box-shadow: var(--shadow); transition: transform .06s ease, box-shadow .2s ease; }
      .task:hover { transform: translateY(-1px); box-shadow: 0 4px 10px rgba(9,30,66,0.12), 0 0 1px rgba(9,30,66,0.12); }
      .task h4 { margin: 0 0 6px; font-size: 14px; display: flex; gap: 6px; align-items: center; font-weight: 600; }
      .meta { display: flex; justify-content: space-between; align-items: center; margin-top: 4px; }
      .chips { display: flex; gap: 6px; flex-wrap: wrap; }
      .chip { font-size: 11px; padding: 3px 8px; border-radius: 999px; border: 1px solid var(--border); background: #F4F5F7; color: #42526E; }
      .chip--prio-high { background: #FFEBE6; border-color: #FFBDAD; color: #BF2600; }
      .chip--prio-normal { background: #EAE6FF; border-color: #C0B6F2; color: #403294; }
      .chip--prio-low { background: #E3FCEF; border-color: #ABF5D1; color: #006644; }
      .actions { display: flex; gap: 8px; flex-wrap: wrap; }
      .btn { padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); cursor: pointer; font-size: 12px; box-shadow: var(--shadow); color: var(--text); }
      .btn:hover { background: #F4F5F7; }
      .btn--primary { background: var(--primary); color: white; border-color: var(--primary); }
      .btn--primary:hover { background: var(--primary-hover); }
      .btn--danger { border-color: var(--danger); color: var(--danger); }
      .btn--danger:hover { background: #FFEBE6; }
      .hidden { display: none; }
      .tag { background: #E9F2FF; color: #0747A6; padding: 2px 8px; margin-right: 4px; border-radius: 999px; font-size: 11px; border: 1px solid #CCE0FF; }
      .toolbar { display: flex; gap: 10px; margin: 6px 0 12px; }
      .toolbar input, .toolbar select { margin: 0; }
      .empty { text-align: center; color: var(--muted); padding: 28px 10px; border: 1px dashed var(--border); border-radius: var(--radius); background: var(--surface); box-shadow: var(--shadow); }
      .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 11px; border: 1px solid var(--border); border-bottom-width: 2px; padding: 1px 5px; border-radius: 6px; background: #FFF; }
      .section-title { font-size: 12px; color: var(--muted-strong); margin: 10px 0 6px; padding-left: 4px; }
      .task--overdue { border-left: 3px solid var(--danger); background: #FFF5F5; }
      @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(4px);} to { opacity: 1; transform: translateY(0);} }
      .task { animation: fadeSlideIn .18s ease both; }

      /* 毎週の曜日選択（チェックボックスと文字の中央揃え） */
      #weeklyOpts > div {
        /* 行全体を中央に配置 */
        display: flex;
        justify-content: center;
        gap: 8px;
      }
      #weeklyOpts > div > label {
        /* ラベル内でチェックボックスと文字を中央に揃える */
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        line-height: 1;
      }
      #weeklyOpts > div > label > input[type="checkbox"] {
        /* 余白のばらつきを抑え、垂直位置を安定させる */
        margin: 0;
        vertical-align: middle;
      }

      /* ダークモード（ブルーブラック系） */
      @media (prefers-color-scheme: dark) {
        body:not([data-theme="light"]) {
          --bg: #0B1220;
          --surface: #0F172A;
          --elevated: #121B30;
          --text: #F9FBFF;           /* 主要テキストをさらに明るく */
          --muted: #D7E4FF;          /* 補助テキストも明るく */
          --muted-strong: #FFFFFF;   /* セクション見出しなど */
          --border: #233455;
          --primary: #73AEFF;
          --primary-hover: #5FA0FF;
          --danger: #FF8D84;
          --danger-hover: #E97E75;
        }
        /* システムのダーク時のヘッダー配色（設定画面と揃える） */
        body:not([data-theme="light"]) header { background: linear-gradient(180deg, #0F172A 0%, #0B1220 100%); border-bottom-color: #1F2A44; }
        body:not([data-theme="light"]) header .title { color: var(--text); }
        body:not([data-theme="light"]) header a { color: var(--primary); }
        /* ツールバーの入力もダーク配色に */
        body:not([data-theme="light"]) .toolbar input, body:not([data-theme="light"]) .toolbar select { background: #121B30; color: var(--text); border-color: #1F2A44; }
      }
      /* 手動ダーク適用（最優先） */
      body[data-theme="dark"] {
        --bg: #0B1220;
        --surface: #0F172A;
        --elevated: #121B30;
        --text: #F9FBFF;            /* 主要テキストをさらに明るく */
        --muted: #D7E4FF;           /* 補助テキストも明るく */
        --muted-strong: #FFFFFF;    /* セクション見出しなど */
        --border: #233455;
        --primary: #73AEFF;
        --primary-hover: #5FA0FF;
        --danger: #FF8D84;
        --danger-hover: #E97E75;
      }
      body[data-theme="dark"] header { background: linear-gradient(180deg, #0F172A 0%, #0B1220 100%); border-bottom-color: #1F2A44; }
      body[data-theme="dark"] header a { color: var(--primary); }
      body[data-theme="dark"] .btn { background: #182136; border-color: #2A3B5F; color: var(--text); }
      body[data-theme="dark"] .btn:hover { background: #1F2A44; }
      body[data-theme="dark"] .chip { background: #141F36; border-color: #223456; color: #E6EFFF; }
      body[data-theme="dark"] .section-title { color: var(--muted-strong); }
      body[data-theme="dark"] .task h4 { color: var(--text); }
      body[data-theme="dark"] label { color: var(--text); }
      body[data-theme="dark"] .task { border-color: #1F2A44; }
      body[data-theme="dark"] .task:hover { box-shadow: 0 4px 10px rgba(7,15,30,0.4), 0 0 1px rgba(7,15,30,0.4); }
      body[data-theme="dark"] .toolbar input, body[data-theme="dark"] .toolbar select { background: #121B30; color: var(--text); border-color: #1F2A44; }
      body[data-theme="dark"] .chip--prio-high { background: #2B1D1F; border-color: #5F2C30; color: #FF9C8B; }
      body[data-theme="dark"] .chip--prio-normal { background: #1E2233; border-color: #2E3A5F; color: #B8C7FF; }
      body[data-theme="dark"] .chip--prio-low { background: #0E2A21; border-color: #1E4D3B; color: #9ADBC0; }
      body[data-theme="dark"] .tag { background: #1E2A44; border-color: #2E3A5F; color: #B8C7FF; }
      body[data-theme="dark"] .task--overdue { background: #1D1415; }
      body[data-theme="dark"] .empty { background: var(--surface); }
      body[data-theme="dark"] form input, body[data-theme="dark"] form select, body[data-theme="dark"] form textarea { background: #121B30; color: var(--text); border-color: #1F2A44; }
      body[data-theme="dark"] input::placeholder, body[data-theme="dark"] textarea::placeholder { color: var(--muted); opacity: .95; }
    </style>
  </head>
  <body>
    <header>
      <span class="title">Todorima – Optimal Reminder</span>
      <a href="../options/options.html" target="_blank" data-i18n="settings">Settings</a>
    </header>

    <div class="nav">
      <button class="tab" type="button" id="tab-list" aria-selected="true" data-i18n="tabList">List</button>
      <button class="tab" type="button" id="tab-add" data-i18n="tabAdd">Add</button>
    </div>

    <section class="container hidden" id="view-add">
      <form id="taskForm" autocomplete="off">
        <input type="hidden" id="taskId" />
        <input id="title" data-i18n-placeholder="titlePlaceholder" placeholder="Title" required />
        <textarea id="note" rows="2" data-i18n-placeholder="notePlaceholder" placeholder="Note"></textarea>
        <div class="row">
          <input id="due" type="datetime-local" required />
          <select id="priority">
            <option value="normal" data-i18n="priorityNormal">Normal</option>
            <option value="high" data-i18n="priorityHigh">High</option>
            <option value="low" data-i18n="priorityLow">Low</option>
          </select>
        </div>
        <input id="tags" data-i18n-placeholder="tagsPlaceholder" placeholder="Tags (comma-separated)" />
        <div class="row">
          <select id="repeatType">
            <option value="none" data-i18n="repeatNone">No repeat</option>
            <option value="daily" data-i18n="repeatDaily">Daily</option>
            <option value="weekly" data-i18n="repeatWeekly">Weekly</option>
            <option value="monthly" data-i18n="repeatMonthly">Monthly</option>
          </select>
          <input id="interval" type="number" min="1" value="1" data-i18n-title="labelInterval" title="Interval" />
        </div>
        <div id="weeklyOpts" class="small hidden">
          <label data-i18n="labelWeekdays">Weekdays:</label>
          <div>
            <label><input type="checkbox" value="0"><span data-i18n="weekdaySun">Sun</span></label>
            <label><input type="checkbox" value="1"><span data-i18n="weekdayMon">Mon</span></label>
            <label><input type="checkbox" value="2"><span data-i18n="weekdayTue">Tue</span></label>
            <label><input type="checkbox" value="3"><span data-i18n="weekdayWed">Wed</span></label>
            <label><input type="checkbox" value="4"><span data-i18n="weekdayThu">Thu</span></label>
            <label><input type="checkbox" value="5"><span data-i18n="weekdayFri">Fri</span></label>
            <label><input type="checkbox" value="6"><span data-i18n="weekdaySat">Sat</span></label>
          </div>
        </div>
        <div id="monthlyOpts" class="small hidden">
          <label data-i18n="labelDayOfMonth">Day of month:</label>
          <input id="byDay" type="number" min="1" max="31" />
        </div>
        <div class="row">
          <button class="btn btn--primary" type="submit" id="saveBtn" data-i18n="save">Save</button>
          <button class="btn" type="button" id="resetBtn" data-i18n="reset">Reset</button>
        </div>
      </form>
    </section>

    <section class="container" id="view-list">
      <div class="toolbar row">
        <input id="q" data-i18n-placeholder="searchPlaceholderWithTags" placeholder="Search (title, tags)" />
        <select id="sort">
          <option value="due" data-i18n="sortDueAsc">Due (asc)</option>
          <option value="priority" data-i18n="sortPriority">Priority</option>
        </select>
      </div>
      <section class="tasks" id="list"></section>
    </section>

    <script type="module" src="./popup.js"></script>
  </body>
  </html>
